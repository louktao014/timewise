<div class="modal-overlay">
  <div class="modal-content">
    <h2>{{ day().date.toDateString() }}</h2>
    <div class="tabs">
      <button (click)="mode.set('view')" [class.active]="mode() === 'view'">View</button>
      <button (click)="mode.set('add')" [class.active]="mode() === 'add'">
        {{ isEditing ? 'Edit' : 'Add' }}
      </button>
    </div>

    @if (mode() === 'view') {
    <div class="work-times-list">
      @for (workTime of workTimes(); track workTime; let i = $index) {
      <div
        class="work-time-item"
        [ngStyle]="{
          color: workTime.type === 'work' ? 'white' : 'rgba(255, 0, 0, 1)'
        }"
      >
        <span>
          {{ workTime.startTime }} - {{ workTime.endTime }}: {{ workTime.employee }} ({{
            workTime.type
          }})
        </span>
        <div class="work-time-actions">
          <button (click)="editWorkTime(i)" class="btn btn-sm btn-secondary">Edit</button>
          <button (click)="deleteWorkTime(i)" class="btn btn-sm btn-danger">Delete</button>
        </div>
      </div>
      } @if (workTimes().length === 0) {
      <p>No work times scheduled for this day.</p>
      }
    </div>
    <button (click)="switchToAddMode()" class="btn btn-primary">Add New</button>
    } @else {
    <form (ngSubmit)="addOrUpdateWorkTime()">
      <div class="form-group">
        <label for="startTime">Start Time</label>
        <input
          type="time"
          id="startTime"
          [(ngModel)]="newWorkTime().startTime"
          name="startTime"
          required
        />
      </div>
      <div class="form-group">
        <label for="endTime">End Time</label>
        <input
          type="time"
          id="endTime"
          [(ngModel)]="newWorkTime().endTime"
          name="endTime"
          required
        />
      </div>
      <div class="form-group">
        <label for="employee">Employee</label>
        <input
          type="text"
          id="employee"
          [(ngModel)]="newWorkTime().employee"
          name="employee"
          required
        />
      </div>
      <div class="form-group" style="display: flex; flex-direction: column; gap: 8px">
        <label>Type</label>
        <div class="segmented-control">
          <button
            type="button"
            [class.active]="newWorkTime().type === 'work'"
            (click)="setType('work')"
          >
            Work
          </button>
          <button
            type="button"
            [class.active]="newWorkTime().type === 'leave'"
            (click)="setType('leave')"
          >
            Leave
          </button>
        </div>
        @if(newWorkTime().type === 'leave'){
        <label>Reason</label>
        <input type="text" id="reason" [(ngModel)]="newWorkTime().reason" name="reason" required />
        }
      </div>
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">{{ isEditing ? 'Update' : 'Add' }}</button>
        <button type="button" (click)="mode.set('view')" class="btn">Cancel</button>
      </div>
    </form>
    }

    <div class="modal-actions">
      <button (click)="onSave()" class="btn btn-primary">Save Changes</button>
      <button (click)="close()" class="btn">Cancel</button>
    </div>
  </div>
</div>
